name: job-image
description: "push emissary image to dev"

runs:
  using: "composite"
  steps:
    - name: Install Deps
      uses: ./.github/actions/setup-deps
    - name: "Docker Login"
      uses: docker/login-action@v1
      with:
        username: ${{ env.DOCKER_USERNAME }}
        password: ${{ env.DOCKER_PASSWORD }}
    - name: "make push"
      shell: bash
      run: |
        export DOCKER_BUILDKIT=1
        make push
    - name: "make push-dev"
      shell: bash
      run: |
        export DOCKER_BUILDKIT=1
        make push-dev
    - uses: ./.github/actions/git-dirty-check
      name: "Check git not dirty (from make push + make push-dev)"
