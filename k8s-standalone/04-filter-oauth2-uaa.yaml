# @TEMPLATE@
---
apiVersion: getambassador.io/v1beta2
kind: Filter
metadata:
  name: uaa
  namespace: default
spec:
  OAuth2:
    authorizationURL: {{env "IDP_UAA_PROVIDER_URL"}}
    clientURL: {{env "AUTH_TENANT_URL"}}
    clientID: {{env "IDP_UAA_CLIENT_ID"}}
    secret: {{env "IDP_UAA_CLIENT_SECRET"}}
---
apiVersion: getambassador.io/v1
kind: Mapping
metadata:
  name: filter-oauth2-uaa-mapping
  namespace: default
spec:
  prefix: /uaa/httpbin/
  rewrite: /
  service: httpbin.org:80
  host_rewrite: httpbin.org
  timeout_ms: 5000
---
apiVersion: getambassador.io/v1beta2
kind: FilterPolicy
metadata:
  name: filter-oauth2-uaa-policy
  namespace: default
spec:
  rules:
  - host: "*"
    path: /uaa/httpbin/**
    filters:
    - name: uaa
