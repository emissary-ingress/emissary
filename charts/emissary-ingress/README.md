# Emissary

[Emissary Ingress](https://github.com/datawire/ambassador) - Emissary Ingress is a self-service, comprehensive API gateway that is Kubernetes-native and built on [Envoy Proxy](https://www.envoyproxy.io/).

## TL;DR;

```console
$ helm repo add emissary-ingress https://s3.amazonaws.com/datawire-static-files/emissary-charts
$ helm repo update
$ helm install emissary-ingress emissary-ingress/emissary-ingress -n ambassador --version=v0.0.1
```

## Introduction

This chart deploys Emissary Ingress on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.

## Prerequisites

- Kubernetes v1.11+

## Installing the Chart

To install the chart with the release name `emissary-ingress`:

```console
$ helm install emissary-ingress emissary-ingress/emissary-ingress -n ambassador --version=v0.0.1
```

The command deploys Emissary Ingress on the Kubernetes cluster in the default configuration. The [configuration](#configuration) section lists the parameters that can be configured during installation.

> **Tip**: List all releases using `helm list`

## Uninstalling the Chart

To uninstall/delete the `emissary-ingress`:

```console
$ helm delete emissary-ingress -n ambassador
```

The command removes all the Kubernetes components associated with the chart and deletes the release.

## Changelog

Notable chart changes are listed in the [CHANGELOG](./CHANGELOG.md)

## Configuration

The following table lists the configurable parameters of the `emissary-ingress` chart and their default values.

|               Parameter               |                                                                                                                                                 Description                                                                                                                                                  |                                                                                                                                    Default                                                                                                                                     |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| nameOverride                          | Override the generated chart name. Defaults to .Chart.Name.                                                                                                                                                                                                                                                  | `''`                                                                                                                                                                                                                                                                           |
| fullnameOverride                      | Override the generated release name. Defaults to .Release.Name.                                                                                                                                                                                                                                              | `''`                                                                                                                                                                                                                                                                           |
| namespaceOverride                     | Override the generated release namespace. Defaults to .Release.Namespace.                                                                                                                                                                                                                                    | `''`                                                                                                                                                                                                                                                                           |
| replicaCount                          | Number of Ambassador replicas                                                                                                                                                                                                                                                                                | `3`                                                                                                                                                                                                                                                                            |
| daemonSet                             | If true, Create a DaemonSet. By default Deployment controller will be created                                                                                                                                                                                                                                | `false`                                                                                                                                                                                                                                                                        |
| test.enabled                          | If true, Create test Pod to verify the Ambassador service works correctly (Only created on helm test)                                                                                                                                                                                                        | `true`                                                                                                                                                                                                                                                                         |
| test.image                            | Image to use for the test Pod                                                                                                                                                                                                                                                                                | `busybox`                                                                                                                                                                                                                                                                      |
| autoscaling                           | Enable autoscaling using HorizontalPodAutoscaler daemonSet: true, autoscaling will be disabled                                                                                                                                                                                                               | `{"enabled":false,"maxReplicas":5,"metrics":[{"resource":{"name":"cpu","target":{"averageUtilization":60,"type":"Utilization"}},"type":"Resource"},{"resource":{"name":"memory","target":{"averageUtilization":60,"type":"Utilization"}},"type":"Resource"}],"minReplicas":2}` |
| namespace.name                        | Explicitly set the AMBASSADOR_NAMESPACE environment variable                                                                                                                                                                                                                                                 | ``                                                                                                                                                                                                                                                                             |
| security.podSecurityContext           | Security Context for all containers in the pod. https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#podsecuritycontext-v1-core                                                                                                                                                              | `{"runAsUser":8888}`                                                                                                                                                                                                                                                           |
| security.containerSecurityContext     | Security Context for the Ambassador container specifically https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#securitycontext-v1-core                                                                                                                                                      | `{"allowPrivilegeEscalation":false}`                                                                                                                                                                                                                                           |
| image.repository                      | Emissary Ingress docker repo                                                                                                                                                                                                                                                                                 | `docker.io/datawire/ambassador`                                                                                                                                                                                                                                                |
| image.tag                             | Emissary Ingress docker tag                                                                                                                                                                                                                                                                                  | `1.13.7`                                                                                                                                                                                                                                                                       |
| image.pullPolicy                      | Pod container image pull policy                                                                                                                                                                                                                                                                              | `IfNotPresent`                                                                                                                                                                                                                                                                 |
| dnsPolicy                             | Dns policy, when hostNetwork set to ClusterFirstWithHostNet                                                                                                                                                                                                                                                  | `ClusterFirst`                                                                                                                                                                                                                                                                 |
| hostNetwork                           | If true, uses the host network, useful for on-premise setups                                                                                                                                                                                                                                                 | `false`                                                                                                                                                                                                                                                                        |
| service.type                          |                                                                                                                                                                                                                                                                                                              | `LoadBalancer`                                                                                                                                                                                                                                                                 |
| service.externalTrafficPolicy         |                                                                                                                                                                                                                                                                                                              | ``                                                                                                                                                                                                                                                                             |
| service.sessionAffinity               |                                                                                                                                                                                                                                                                                                              | ``                                                                                                                                                                                                                                                                             |
| service.sessionAffinityConfig         |                                                                                                                                                                                                                                                                                                              | ``                                                                                                                                                                                                                                                                             |
| service.nameOverride                  | Manually set the name of the generated Service                                                                                                                                                                                                                                                               | ``                                                                                                                                                                                                                                                                             |
| adminService.create                   | If true, create a service for Ambassador's admin UI                                                                                                                                                                                                                                                          | `true`                                                                                                                                                                                                                                                                         |
| adminService.type                     | Ambassador's admin service type to be used                                                                                                                                                                                                                                                                   | `ClusterIP`                                                                                                                                                                                                                                                                    |
| adminService.port                     |                                                                                                                                                                                                                                                                                                              | `8877`                                                                                                                                                                                                                                                                         |
| adminService.snapshotPort             |                                                                                                                                                                                                                                                                                                              | `8005`                                                                                                                                                                                                                                                                         |
| adminService.nodePort                 | If explicit NodePort for admin service is required                                                                                                                                                                                                                                                           | ``                                                                                                                                                                                                                                                                             |
| adminService.loadBalancerIP           | IP address to assign (if cloud provider supports it)                                                                                                                                                                                                                                                         | ``                                                                                                                                                                                                                                                                             |
| adminService.loadBalancerSourceRanges | Passed to cloud provider load balancer if created (e.g: AWS ELB)                                                                                                                                                                                                                                             | ``                                                                                                                                                                                                                                                                             |
| rbac.create                           | Specifies whether RBAC resources should be created                                                                                                                                                                                                                                                           | `true`                                                                                                                                                                                                                                                                         |
| rbac.nameOverride                     | Name of the RBAC resources defaults to the name of the release. Set nameOverride when installing Ambassador with cluster-wide scope in different namespaces with the same release name to avoid conflicts.                                                                                                   | ``                                                                                                                                                                                                                                                                             |
| scope.singleNamespace                 | Set the AMBASSADOR_SINGLE_NAMESPACE environment variable and create namespaced RBAC if rbac.enabled: true                                                                                                                                                                                                    | `false`                                                                                                                                                                                                                                                                        |
| serviceAccount.create                 | Specifies whether a service account should be created                                                                                                                                                                                                                                                        | `true`                                                                                                                                                                                                                                                                         |
| serviceAccount.name                   | The name of the service account to use. If not set and create is true, a name is generated using the fullname template                                                                                                                                                                                       | ``                                                                                                                                                                                                                                                                             |
| deploymentStrategy.type               |                                                                                                                                                                                                                                                                                                              | `RollingUpdate`                                                                                                                                                                                                                                                                |
| restartPolicy                         |                                                                                                                                                                                                                                                                                                              | ``                                                                                                                                                                                                                                                                             |
| terminationGracePeriodSeconds         |                                                                                                                                                                                                                                                                                                              | ``                                                                                                                                                                                                                                                                             |
| livenessProbe                         | Liveness probe for emissary pods                                                                                                                                                                                                                                                                             | `{"failureThreshold":3,"initialDelaySeconds":30,"periodSeconds":3}`                                                                                                                                                                                                            |
| readinessProbe                        | Liveness probe for emissary pods                                                                                                                                                                                                                                                                             | `{"failureThreshold":3,"initialDelaySeconds":30,"periodSeconds":3}`                                                                                                                                                                                                            |
| resources                             | CPU/memory resource requests/limits                                                                                                                                                                                                                                                                          | `{"limits":{"cpu":"1000m","memory":"600Mi"},"requests":{"cpu":"200m","memory":"300Mi"}}`                                                                                                                                                                                       |
| priorityClassName                     | The name of the priorityClass for the ambassador DaemonSet/Deployment                                                                                                                                                                                                                                        | `''`                                                                                                                                                                                                                                                                           |
| ambassadorConfig                      | Config thats mounted to `/ambassador/ambassador-config`                                                                                                                                                                                                                                                      | `''`                                                                                                                                                                                                                                                                           |
| crds.enabled                          | If `true`, enables CRD resources for the installation.                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                         |
| crds.create                           | If true, Creates CRD resources                                                                                                                                                                                                                                                                               | `true`                                                                                                                                                                                                                                                                         |
| crds.keep                             | If true, if the ambassador CRDs should be kept when the chart is deleted                                                                                                                                                                                                                                     | `true`                                                                                                                                                                                                                                                                         |
| metrics.serviceMonitor.enabled        |                                                                                                                                                                                                                                                                                                              | `false`                                                                                                                                                                                                                                                                        |
| resolvers                             | Resolvers are used to configure the discovery service strategy for Ambasador See: https://www.getambassador.io/docs/edge-stack/latest/topics/running/resolvers/ <br> Example: <br> `Configuration for a Consul Resolver` <br> `address: consul-server.default.svc.cluster.local:8500` <br> `datacenter: dc1` | `{"consul":{"create":false,"name":"consul-dc1","spec":{}},"endpoint":{"create":false,"name":"endpoint"}}`                                                                                                                                                                      |
| prometheusExporter                    | DEPRECATED: Enabling the prometheus exporter creates a sidecar and configures ambassador to use it Ambassador now exposes the /metrics endpoint in Envoy. See https://www.getambassador.io/user-guide/monitoring#deployment for more information on how to use the /metrics endpoint                         | `{"enabled":false,"pullPolicy":"IfNotPresent","repository":"prom/statsd-exporter","resources":{},"tag":"v0.8.1"}`                                                                                                                                                              |
| agent.enabled                         | If `true`, installs the ambassador-agent Deployment, ServiceAccount and ClusterRole in the ambassador namespace, enabling the Service Catalog                                                                                                                                                                | `true`                                                                                                                                                                                                                                                                         |
| agent.cloudConnectToken               | API token for reporting snapshots to the [Service Catalog](https://app.getambassador.io/cloud/catalog/); If empty, agent will not report snapshots                                                                                                                                                           | `''`                                                                                                                                                                                                                                                                           |
| agent.rpcAddress                      | Address of the ambassador Service Catalog rpc server.                                                                                                                                                                                                                                                        | `https://app.getambassador.io/`                                                                                                                                                                                                                                                |
| agent.createArgoRBAC                  |                                                                                                                                                                                                                                                                                                              | `true`                                                                                                                                                                                                                                                                         |
| agent.image.tag                       | Leave blank to use image.repository and image.tag                                                                                                                                                                                                                                                            | ``                                                                                                                                                                                                                                                                             |
| agent.image.repository                |                                                                                                                                                                                                                                                                                                              | ``                                                                                                                                                                                                                                                                             |
| deploymentTool                        |                                                                                                                                                                                                                                                                                                              | `''`                                                                                                                                                                                                                                                                           |
| createNamespace                       |                                                                                                                                                                                                                                                                                                              | `false`                                                                                                                                                                                                                                                                        |


Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`. For example:

```console
$ helm install emissary-ingress emissary-ingress/emissary-ingress -n ambassador --version=v0.0.1 --set nameOverride=''
```

Alternatively, a YAML file that specifies the values for the parameters can be provided while
installing the chart. For example:

```console
$ helm install emissary-ingress emissary-ingress/emissary-ingress -n ambassador --version=v0.0.1 --values values.yaml
```
