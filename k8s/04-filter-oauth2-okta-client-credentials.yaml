# @TEMPLATE@
---
apiVersion: getambassador.io/v1beta2
kind: Filter
metadata:
  name: okta-client-credentials
  namespace: standalone
spec:
  OAuth2:
    authorizationURL: {{env "IDP_OKTA_PROVIDER_URL"}}
    grantType: ClientCredentials
---
apiVersion: getambassador.io/v1
kind: Mapping
metadata:
  name: filter-oauth2-okta-client-credentialsmapping
  namespace: standalone
spec:
  prefix: /okta-client-credentials/httpbin/
  rewrite: /
  service: httpbin.org:80
  host_rewrite: httpbin.org
  timeout_ms: 5000
---
apiVersion: getambassador.io/v1beta2
kind: FilterPolicy
metadata:
  name: filter-oauth2-okta-client-credentials-policy
  namespace: standalone
spec:
  rules:
    - host: "*"
      path: /okta-client-credentials/httpbin/**
      filters:
      - name: okta-client-credentials
        arguments:
          scopes:
          - "myScope"
