---
apiVersion: v1
kind: Pod
metadata:
  name: cloudknife-backend
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: cloud.google.com/gke-nodepool
                operator: In
                values: ["backends"]
  containers:
    - name: cloudknife
      image: quay.io/datawire/cloudknife
      imagePullPolicy: Always
      volumeMounts:
        - name: docker
          mountPath: "/var/run/docker.sock"
  volumes:
    - name: docker
      hostPath:
        path: "/var/run/docker.sock"

---
apiVersion: v1
kind: Pod
metadata:
  name: cloudknife-generator
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: cloud.google.com/gke-nodepool
                operator: In
                values: ["generators"]
  containers:
    - name: cloudknife-backend
      image: quay.io/datawire/cloudknife
      imagePullPolicy: Always
      volumeMounts:
        - name: docker
          mountPath: "/var/run/docker.sock"
  volumes:
    - name: docker
      hostPath:
        path: "/var/run/docker.sock"

---
apiVersion: v1
kind: Pod
metadata:
  name: cloudknife-prometheus
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: cloud.google.com/gke-nodepool
                operator: In
                values: ["generators"]
  containers:
    - name: cloudknife-backend
      image: quay.io/datawire/cloudknife
      imagePullPolicy: Always
      volumeMounts:
        - name: docker
          mountPath: "/var/run/docker.sock"
  volumes:
    - name: docker
      hostPath:
        path: "/var/run/docker.sock"
  serviceAccountName: prometheus-operator
