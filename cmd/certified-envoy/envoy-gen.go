// +build generate

package main

import (
	"io/ioutil"
	"os"
	"text/template"
)

// Emit the Envoy binary named by os.Args[1] as a Go string
// ("const envoyBytes = ...").

const tmplStr = `// Code generated by Make DO NOT EDIT.

// +build linux,amd64
// +build !lint

package main

const envoyBytes = {{ printf "%q" .envoyBytes }}
`

func main() {
	envoyBytes, err := ioutil.ReadFile(os.Args[1])
	if err != nil {
		panic(err)
	}

	tmpl := template.Must(template.
		New("envoyBytes").
		Parse(tmplStr))

	err = tmpl.Execute(os.Stdout, map[string]interface{}{
		"envoyBytes": envoyBytes,
	})
	if err != nil {
		panic(err)
	}
}
